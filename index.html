<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>מה שראיתי כשקמתי</title>

  <!-- Favicon -->
  <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>🔆</text></svg>" />

  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
  <!-- language switch -->
  <div class="lang-container">
    <button id="heBtn" class="lang-switch active">עברית</button>
    <button id="enBtn" class="lang-switch">English</button>
  </div>

  <!-- memoir content -->
  <main id="main" class="container" dir="rtl">
    <div id="content">טוען…</div>
  </main>

  <!-- bottom navigation (always visible) -->
  <nav id="bottomNav" class="bottom-nav">
    <button id="prevBtn"><span class="icon-nav">⬆️</span><small>Prev</small></button>
    <button id="tocBtn"><span class="icon-nav">☰</span><small>Index</small></button>
    <button id="nextBtn"><span class="icon-nav">⬇️</span><small>Next</small></button>
    <a   href="#contact" class="footerBtn"><span class="icon-nav">📷</span><small>IG</small></a>
  </nav>

  <!-- TOC drawer -->
  <aside id="tocOverlay" class="toc-overlay">
    <div class="toc-sheet">
      <h3>תוכן עניינים</h3>
      <ul id="tocList"></ul>
    </div>
  </aside>

  <!-- footer -->
  <footer id="contact">
    <div class="contact-info">
      <a href="https://www.instagram.com/tully_hoffmann" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Instagram_logo_2022.svg/256px-Instagram_logo_2022.svg.png"
             alt="" class="icon" />Tully Instagram
      </a>
      <a href="https://www.instagram.com/rawpresence" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Instagram_logo_2022.svg/256px-Instagram_logo_2022.svg.png"
             alt="" class="icon" />Raw Presence Lab
      </a>
      <a href="mailto:tullyhoffmann@gmail.com">✉️ Email</a>
    </div>
    <p class="copyright">© 2025 Tully Hoffmann — All rights reserved</p>
  </footer>

  <script>
    /* --- markdown loader --- */
    const contentEl = document.getElementById('content');
    const mainEl    = document.getElementById('main');
    const heBtn     = document.getElementById('heBtn');
    const enBtn     = document.getElementById('enBtn');

    let headings = [], currentIndex = 0;
    function loadLanguage(lang) {
      fetch(lang === 'en' ? 'memoir.md' : 'memoir-he.md')
        .then(r => r.text())
        .then(md => {
          marked.setOptions({ breaks:true });
          contentEl.innerHTML = marked.parse(md);
          buildTOC(); observeSections();
        });
      document.documentElement.lang = lang;
      mainEl.setAttribute('dir', lang === 'he' ? 'rtl' : 'ltr');
      [heBtn, enBtn].forEach(btn => btn.classList.toggle('active', btn.id.startsWith(lang)));
    }
    heBtn.onclick = () => loadLanguage('he');
    enBtn.onclick = () => loadLanguage('en');
    loadLanguage('he');   // default

    /* --- TOC & anchors --- */
    const tocOverlay = document.getElementById('tocOverlay');
    const tocList    = document.getElementById('tocList');
    function buildTOC(){
      tocList.innerHTML = '';
      headings = [...contentEl.querySelectorAll('h2')];
      headings.forEach((h,i)=>{
        h.id=`section-${i}`;
        tocList.insertAdjacentHTML('beforeend',`<li><a href="#${h.id}">${h.textContent}</a></li>`);
      });
    }

    /* --- section observer --- */
    function observeSections(){
      const io=new IntersectionObserver(entries=>{
        entries.forEach(e=>{
          if(e.isIntersecting){currentIndex=headings.indexOf(e.target);updateNav();}
        });
      },{rootMargin:'-45% 0px -45% 0px'});
      headings.forEach(h=>io.observe(h));
    }

    /* --- bottom nav actions --- */
    const prevBtn=document.getElementById('prevBtn');
    const nextBtn=document.getElementById('nextBtn');
    prevBtn.onclick=()=>{if(currentIndex>0) headings[currentIndex-1].scrollIntoView({behavior:'smooth'});};
    nextBtn.onclick=()=>{if(currentIndex<headings.length-1) headings[currentIndex+1].scrollIntoView({behavior:'smooth'});};
    const tocBtn=document.getElementById('tocBtn');
    tocBtn.onclick = ()=>tocOverlay.classList.add('open');
    tocOverlay.onclick = e=>{if(e.target===tocOverlay) tocOverlay.classList.remove('open');};
    tocList.addEventListener('click',()=>tocOverlay.classList.remove('open'));
    function updateNav(){
      prevBtn.disabled=currentIndex===0;
      nextBtn.disabled=currentIndex===headings.length-1;
    }

    /* --- scroll progress bar --- */
    const root=document.documentElement;
    window.addEventListener('scroll',()=>{
      const h=document.documentElement.scrollHeight-innerHeight;
      root.style.setProperty('--scroll',`${(scrollY/h)*100}%`);
    });
  </script>
</body>
</html>