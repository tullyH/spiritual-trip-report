<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>מה שראיתי כשקמתי</title>

  <!-- Favicon -->
  <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>🔆</text></svg>" />

  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
  <!-- language switch -->
  <div class="lang-container">
    <button id="heBtn" class="lang-switch active">עברית</button>
    <button id="enBtn" class="lang-switch">English</button>
  </div>

  <!-- NEW contact shortcut -->
  <div class="quick-contact">
    <a href="#contact" aria-label="Instagram / Contact">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Instagram_logo_2022.svg/128px-Instagram_logo_2022.svg.png"
           alt="" class="qc-icon" />
    </a>
    <a href="#contact" aria-label="Email">
      ✉️
    </a>
  </div>

  <!-- memoir content -->
  <main id="main" class="container" dir="rtl">
    <div id="content">טוען…</div>
  </main>

  <!-- bottom nav (thin, hides on scroll) -->
  <nav id="bottomNav" class="bottom-nav">
    <button id="prevBtn" aria-label="Previous">⬆️</button>
    <button id="tocBtn"  aria-label="Index">☰</button>
    <button id="nextBtn" aria-label="Next">⬇️</button>
  </nav>

  <!-- TOC drawer -->
  <aside id="tocOverlay" class="toc-overlay">
    <div class="toc-sheet"><ul id="tocList"></ul></div>
  </aside>

  <!-- footer -->
  <footer id="contact">
    <div class="contact-info">
      <a href="https://www.instagram.com/tully_hoffmann" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Instagram_logo_2022.svg/256px-Instagram_logo_2022.svg.png"
             alt="" class="icon" />Tully Instagram
      </a>
      <a href="https://www.instagram.com/rawpresence" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Instagram_logo_2022.svg/256px-Instagram_logo_2022.svg.png"
             alt="" class="icon" />Raw Presence Lab
      </a>
      <a href="mailto:tullyhoffmann@gmail.com">✉️ Email</a>
    </div>
    <p class="copyright">© 2025 Tully Hoffmann — All rights reserved</p>
  </footer>

  <script>
    /* ------------ markdown loader + language switch ------------ */
    const contentEl = document.getElementById('content');
    const mainEl    = document.getElementById('main');
    const heBtn     = document.getElementById('heBtn');
    const enBtn     = document.getElementById('enBtn');

    let headings=[],current=0;
    function loadLang(l){
      fetch(l==='en'?'memoir.md':'memoir-he.md')
        .then(r=>r.text())
        .then(md=>{
          marked.setOptions({breaks:true});
          contentEl.innerHTML=marked.parse(md);
          buildTOC();observe();
        });
      document.documentElement.lang=l;
      mainEl.dir=(l==='he')?'rtl':'ltr';
      heBtn.classList.toggle('active',l==='he');
      enBtn.classList.toggle('active',l==='en');
    }
    heBtn.onclick=()=>loadLang('he');
    enBtn.onclick=()=>loadLang('en');
    loadLang('he');

    /* ------------ TOC ------------ */
    const tocOverlay=document.getElementById('tocOverlay');
    const tocList   =document.getElementById('tocList');
    function buildTOC(){
      headings=[...contentEl.querySelectorAll('h2')];
      tocList.innerHTML='';
      headings.forEach((h,i)=>{
        h.id=`s${i}`;
        tocList.insertAdjacentHTML('beforeend',`<li><a href="#${h.id}">${h.textContent}</a></li>`);
      });
    }
    document.getElementById('tocBtn').onclick=()=>tocOverlay.classList.add('open');
    tocOverlay.onclick=e=>{if(e.target===tocOverlay)tocOverlay.classList.remove('open')};
    tocList.addEventListener('click',()=>tocOverlay.classList.remove('open'));

    /* ------------ prev / next detection ------------ */
    const prevBtn=document.getElementById('prevBtn');
    const nextBtn=document.getElementById('nextBtn');
    prevBtn.onclick=()=>current>0&&headings[current-1].scrollIntoView({behavior:'smooth'});
    nextBtn.onclick=()=>current<headings.length-1&&headings[current+1].scrollIntoView({behavior:'smooth'});
    function observe(){
      const io=new IntersectionObserver(es=>{
        es.forEach(e=>{if(e.isIntersecting){current=headings.indexOf(e.target);updateNav();}});
      },{rootMargin:'-45% 0 -45%'});
      headings.forEach(h=>io.observe(h));
    }
    function updateNav(){
      prevBtn.disabled=current===0;
      nextBtn.disabled=current===headings.length-1;
    }

    /* ------------ hide bar on scroll ------------ */
    const bar=document.getElementById('bottomNav');
    let last=0,t;
    addEventListener('scroll',()=>{
      const y=scrollY;
      if(y>last+10) bar.classList.add('hide');
      last=y;
      clearTimeout(t);t=setTimeout(()=>bar.classList.remove('hide'),120);
    },{passive:true});
  </script>
</body>
</html>